# ğŸš¢ åŸºäºYOLOçš„èˆ°èˆ¹è¯†åˆ«æ™ºèƒ½ç³»ç»Ÿ

>ä»£ç è·å–åœ°å€ï¼š[https://mbd.pub/o/bread/YZWbk5lxaw==](https://mbd.pub/o/bread/YZWbk5lxaw==)

## ğŸ“– 1. é¡¹ç›®ä»‹ç» (Project Introduction)

### 1.1 ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰
éšç€å…¨çƒæµ·æ´‹ç»æµçš„è“¬å‹ƒå‘å±•å’Œæµ·æ´‹æƒç›Šç»´æŠ¤éœ€æ±‚çš„æ—¥ç›Šå¢é•¿ï¼Œæµ·åŸŸç›‘æ§åœ¨æµ·äº‹ç›‘ç®¡ã€æ¸¯å£è°ƒåº¦ã€æµ·ä¸Šæœæ•‘åŠå›½é˜²å®‰å…¨ç­‰é¢†åŸŸå‘æŒ¥ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚ä¼ ç»Ÿçš„èˆ°èˆ¹ç›‘æµ‹æ‰‹æ®µä¸»è¦ä¾èµ–äººå·¥ç­æœ›å’Œé›·è¾¾ç›‘æ§ï¼Œå­˜åœ¨ä»¥ä¸‹å±€é™æ€§ï¼š
- **æ•ˆç‡ä½ä¸‹**ï¼šé¢å¯¹æµ·é‡è§†é¢‘ç›‘æ§æ•°æ®ï¼Œäººå·¥æ’æŸ¥è€—æ—¶è´¹åŠ›ï¼Œæ˜“äº§ç”Ÿè§†è§‰ç–²åŠ³ã€‚
- **ä¿¡æ¯ç»´åº¦å•ä¸€**ï¼šä¼ ç»Ÿé›·è¾¾å’Œè§†è§‰ç®—æ³•ä»…èƒ½æä¾›ç›®æ ‡ä½ç½®ï¼Œéš¾ä»¥å¯¹èˆ°èˆ¹çš„å…·ä½“ç±»å‹ã€ä½œä¸šçŠ¶æ€åŠå¼‚å¸¸è¡Œä¸ºè¿›è¡Œæ·±åº¦è¯­ä¹‰åˆ†æã€‚

æœ¬é¡¹ç›®æ—¨åœ¨æ„å»ºä¸€å¥—**é«˜ç²¾åº¦ã€æ™ºèƒ½åŒ–ã€ç«¯åˆ°ç«¯**çš„èˆ°èˆ¹è¯†åˆ«ç³»ç»Ÿã€‚é€šè¿‡ç»“åˆç›®æ ‡æ£€æµ‹æŠ€æœ¯ï¼ˆ**YOLOv8**ï¼‰ä¸å¤šæ¨¡æ€å¤§è¯­è¨€æ¨¡å‹ï¼ˆ**LLaVA**ï¼‰ï¼Œä¸ä»…å®ç°å¯¹æµ·é¢èˆ°èˆ¹çš„å®æ—¶å®šä½ä¸è®¡æ•°ï¼Œè¿˜èƒ½å¯¹ç›®æ ‡è¿›è¡Œæ·±å±‚æ¬¡çš„ç‰¹å¾æè¿°ä¸æ€åŠ¿è¯„ä¼°ï¼Œä»è€Œå®ç°ä»â€œçœ‹å¾—è§â€åˆ°â€œçœ‹å¾—æ‡‚â€çš„æ™ºèƒ½åŒ–è·¨è¶Šã€‚
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/5b0d28961f2e41c481b87323a670060e.png#pic_center)
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/d1b453e611b8407e83039ab51dbaea5d.png#pic_center)
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/b52b707134974801a63643ceb7660ee3.png#pic_center)
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/a86f867d825c457f927bb21e6ec5bc59.png#pic_center)
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/001d49e3614a418ba0710eea33821e94.png#pic_center)

### 1.2 é¡¹ç›®ç›®æ ‡
1.  **é«˜ç²¾åº¦æ£€æµ‹**ï¼šåœ¨å¤æ‚æµ·å†µï¼ˆå¦‚æ³¢æµªã€åå…‰ã€äº‘é›¾é®æŒ¡ï¼‰ä¸‹ï¼Œå®ç°å¯¹èˆ°èˆ¹ç›®æ ‡çš„å‡†ç¡®æ£€æµ‹ä¸å®šä½ã€‚
2.  **æ™ºèƒ½è¯­ä¹‰åˆ†æ**ï¼šåˆ©ç”¨å¤§æ¨¡å‹èƒ½åŠ›ï¼Œè‡ªåŠ¨è¯†åˆ«èˆ°èˆ¹ç±»å‹ï¼ˆè´§èˆ¹ã€å†›èˆ°ç­‰ï¼‰ã€åˆ†æèˆªè¡ŒçŠ¶æ€åŠæ˜¾è‘—å¤–è§‚ç‰¹å¾ã€‚
3.  **å…¨å¤©å€™å®æ—¶ç›‘æ§**ï¼šæ„å»ºå¯è§†åŒ–çš„äº¤äº’å¹³å°ï¼Œæ”¯æŒè§†é¢‘æµçš„å®æ—¶å¤„ç†ä¸å‘Šè­¦ã€‚

---

## ğŸ“‚ 2. æ•°æ®é›†ä»‹ç» (Dataset Description)

### 2.1 æ•°æ®æ¥æºä¸æ„æˆ
æœ¬é¡¹ç›®ä½¿ç”¨ **Ships in Aerial Images**ï¼ˆèˆªæ‹èˆ°èˆ¹æ•°æ®é›†ï¼‰è¿›è¡Œæ¨¡å‹è®­ç»ƒä¸è¯„ä¼°ã€‚è¯¥æ•°æ®é›†ä¸»è¦æ¥æºäºå«æ˜Ÿé¥æ„ŸåŠæ— äººæœºèˆªæ‹å½±åƒï¼Œæ¶µç›–äº†ä¸åŒå…‰ç…§ã€ä¸åŒè§’åº¦åŠä¸åŒæµ·å†µä¸‹çš„èˆ°èˆ¹å›¾åƒã€‚

*   **æ•°æ®é›†è·¯å¾„**: `data/ships-aerial-images/`
*   **æ€»æ ·æœ¬é‡**: åŒ…å«æ•°åƒå¼ é«˜åˆ†è¾¨ç‡èˆªæ‹å›¾åƒã€‚
*   **ç±»åˆ«å®šä¹‰**:
    *   **ship (èˆ°èˆ¹)**: åŒ…å«å„ç±»æµ·é¢èˆ¹åªç›®æ ‡ã€‚

### 2.2 æ•°æ®é¢„å¤„ç†
ä¸ºäº†æ»¡è¶³ YOLOv8 æ¨¡å‹çš„è¾“å…¥è¦æ±‚å¹¶æå‡æ³›åŒ–èƒ½åŠ›ï¼Œå¯¹åŸå§‹æ•°æ®è¿›è¡Œäº†ä»¥ä¸‹é¢„å¤„ç†ï¼š
1.  **æ ¼å¼è½¬æ¢**: å°†æ ‡æ³¨æ•°æ®ç»Ÿä¸€è½¬æ¢ä¸º YOLO æ ¼å¼ (`class_id x_center y_center width height`)ã€‚
2.  **æ•°æ®é›†åˆ’åˆ†**: æŒ‰ç…§ **7:2:1** çš„æ¯”ä¾‹å°†æ•°æ®é›†éšæœºåˆ’åˆ†ä¸ºè®­ç»ƒé›† (Train)ã€éªŒè¯é›† (Validation) å’Œæµ‹è¯•é›† (Test)ã€‚
3.  **æ•°æ®å¢å¼º**: åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­é‡‡ç”¨äº† Mosaic é©¬èµ›å…‹å¢å¼ºã€éšæœºç¿»è½¬ã€HSV è‰²å½©ç©ºé—´å˜æ¢ç­‰æŠ€æœ¯ï¼Œä»¥å¢å¼ºæ¨¡å‹å¯¹å¤æ‚èƒŒæ™¯å’Œå°ç›®æ ‡çš„é²æ£’æ€§ã€‚

---

## ğŸ§  3. æ ¸å¿ƒç®—æ³• (Core Algorithms)

æœ¬ç³»ç»Ÿé‡‡ç”¨ **"æ£€æµ‹ + åˆ†æ"** çš„çº§è”æ¶æ„ã€‚

### 3.1 ç›®æ ‡æ£€æµ‹ç®—æ³•ï¼šYOLOv8 (You Only Look Once v8)
YOLOv8 æ˜¯ç›®å‰æœ€å…ˆè¿›çš„å•é˜¶æ®µç›®æ ‡æ£€æµ‹ç®—æ³•ä¹‹ä¸€ï¼Œå…·æœ‰æ£€æµ‹é€Ÿåº¦å¿«ã€ç²¾åº¦é«˜ã€æ˜“éƒ¨ç½²ç­‰ç‰¹ç‚¹ã€‚
*   **Backbone (ä¸»å¹²ç½‘ç»œ)**: é‡‡ç”¨ CSPDarknet ç»“æ„ï¼Œå¼•å…¥ C2f æ¨¡å—ï¼Œä¸°å¯Œäº†æ¢¯åº¦æµï¼Œå¢å¼ºäº†ç‰¹å¾æå–èƒ½åŠ›ã€‚
*   **Neck (é¢ˆéƒ¨ç½‘ç»œ)**: ä½¿ç”¨ PANet (Path Aggregation Network) ç»“æ„ï¼Œè‡ªé¡¶å‘ä¸‹å’Œè‡ªåº•å‘ä¸ŠåŒå‘èåˆå¤šå°ºåº¦ç‰¹å¾ï¼Œèƒ½æœ‰æ•ˆæ£€æµ‹ä¸åŒå¤§å°çš„èˆ°èˆ¹ç›®æ ‡ã€‚
*   **Head (æ£€æµ‹å¤´)**: é‡‡ç”¨ Decoupled Headï¼ˆè§£è€¦å¤´ï¼‰è®¾è®¡ï¼Œå°†åˆ†ç±»ä»»åŠ¡ä¸å›å½’ä»»åŠ¡åˆ†ç¦»ï¼Œä½¿ç”¨ Anchor-Free ç­–ç•¥ï¼Œç›´æ¥é¢„æµ‹ç›®æ ‡ä¸­å¿ƒä¸å®½é«˜ã€‚
*   **Loss Function**: ä½¿ç”¨ CIoU Loss è¿›è¡Œè¾¹ç•Œæ¡†å›å½’ï¼ŒVFL Loss è¿›è¡Œåˆ†ç±»ï¼Œæ˜¾è‘—æå‡äº†æ”¶æ•›é€Ÿåº¦ä¸å®šä½ç²¾åº¦ã€‚

### 3.2 å¤šæ¨¡æ€åˆ†æç®—æ³•ï¼šLLaVA (Large Language-and-Vision Assistant)
LLaVA æ˜¯ä¸€ç§åŸºäºæŒ‡ä»¤å¾®è°ƒçš„å¤šæ¨¡æ€å¤§æ¨¡å‹ï¼Œèƒ½å¤Ÿç†è§£å›¾åƒå¹¶è¿›è¡Œè‡ªç„¶è¯­è¨€å¯¹è¯ã€‚
*   **Vision Encoder**: ä½¿ç”¨ CLIP (ViT-L/14) ä½œä¸ºè§†è§‰ç¼–ç å™¨ï¼Œå°†å›¾åƒè½¬æ¢ä¸ºè§†è§‰ç‰¹å¾å‘é‡ã€‚
*   **Projection Layer**: é€šè¿‡çº¿æ€§æŠ•å½±å±‚å°†è§†è§‰ç‰¹å¾æ˜ å°„åˆ°è¯­è¨€æ¨¡å‹çš„åµŒå…¥ç©ºé—´ã€‚
*   **LLM (è¯­è¨€æ¨¡å‹)**: åŸºäº LLaMA/Vicuna æ„å»ºï¼Œæ¥æ”¶å›¾åƒç‰¹å¾ä¸æ–‡æœ¬æç¤º (Prompt)ï¼Œç”Ÿæˆå…³äºèˆ°èˆ¹ç±»å‹ã€ç‰¹å¾åŠçŠ¶æ€çš„è¯¦ç»†ä¸­æ–‡æè¿°ã€‚

---

## ğŸ—ï¸ 4. ç³»ç»Ÿæ¶æ„ (System Architecture)

ç³»ç»Ÿé‡‡ç”¨ **B/S (Browser/Server)** æ¶æ„è®¾è®¡ï¼Œå‰åç«¯åˆ†ç¦»ï¼Œæ¨¡å—åŒ–å¼€å‘ã€‚
### 4.1 åŠŸèƒ½æ¨¡å—
1.  **Web äº¤äº’å±‚**: åŸºäº Gradio æ­å»ºï¼Œæä¾›å›¾ç‰‡ä¸Šä¼ ã€è§†é¢‘æµæ§åˆ¶ã€å‚æ•°è®¾ç½®åŠç»“æœå±•ç¤ºç•Œé¢ã€‚
2.  **æ ¸å¿ƒæ£€æµ‹å±‚**: å°è£… YOLOv8 æ¨¡å‹ï¼Œè´Ÿè´£å¯¹è¾“å…¥æµè¿›è¡Œé€å¸§æ£€æµ‹ï¼Œè¾“å‡ºç›®æ ‡è¾¹ç•Œæ¡†(BBox)ä¸ç½®ä¿¡åº¦ã€‚
3.  **æ·±åº¦åˆ†æå±‚**: è°ƒç”¨ Ollama æ¥å£è¿è¡Œ LLaVA æ¨¡å‹ï¼Œæ ¹æ®æ£€æµ‹ç»“æœç”Ÿæˆè¯¦ç»†çš„ä¸­æ–‡åˆ†ææŠ¥å‘Šã€‚
4.  **æ•°æ®ç®¡ç†å±‚**: ä½¿ç”¨ SQLite æ•°æ®åº“å­˜å‚¨å†å²æ£€æµ‹è®°å½•ï¼Œæ”¯æŒæ•°æ®æŒä¹…åŒ–ä¸å¯¼å‡ºã€‚

---

## ğŸ’» 5. æ ¸å¿ƒä»£ç  (Core Code)

### 5.1 èˆ°èˆ¹æ£€æµ‹é€»è¾‘ (`src/ship_recognition_system.py`)
ç³»ç»Ÿçš„æ ¸å¿ƒç±» `ShipRecognitionSystem` å°è£…äº†æ£€æµ‹æµç¨‹ï¼š

```python
class ShipRecognitionSystem:
    def detect_image(self, image_path, conf=0.25, use_llava=False):
        # 1. YOLOv8 ç›®æ ‡æ£€æµ‹
        results, plot_img = self.detector.predict(image_path, conf=conf)
        
        ship_detected = False
        detections = []
        
        # 2. è§£ææ£€æµ‹ç»“æœ
        if len(results) > 0:
            for box in results[0].boxes:
                cls_id = int(box.cls[0])
                if self.class_names[cls_id] == 'ship':
                    ship_detected = True
                    # ... æå–åæ ‡ä¸ç½®ä¿¡åº¦ ...
        
        # 3. LLaVA æ·±åº¦åˆ†æ (å¯é€‰)
        report = ""
        if use_llava and ship_detected:
            analyze_result = self.analyzer.analyze_with_detection(
                image_path, 
                {"detections": detections},
                prompt_key="ship_analysis"
            )
            report = analyze_result.get('llava_analysis', '')
            
        return plot_img, detections, report, save_path, ship_detected
```

### 5.2 å¤šæ¨¡æ€åˆ†æå™¨ (`src/llava_analyzer.py`)
è´Ÿè´£æ„å»º Prompt å¹¶ä¸ LLaVA æ¨¡å‹äº¤äº’ï¼š

```python
class LLaVAAnalyzer:
    def analyze_with_detection(self, image_path, detection_info, prompt_key):
        # æ„å»º Promptï¼Œç»“åˆè§†è§‰ä¿¡æ¯ä¸ä»»åŠ¡æŒ‡ä»¤
        base_prompt = self.config['llava']['prompts'][prompt_key]
        
        # è°ƒç”¨ Ollama API è¿›è¡Œæ¨ç†
        response = self.client.generate(
            model=self.model_name,
            prompt=base_prompt,
            images=[encoded_image]
        )
        return {"llava_analysis": response['response']}
```

---

## ğŸ› ï¸ 6. ä½¿ç”¨æŒ‡å— (Usage Guidelines)

### 6.1 ç¯å¢ƒéƒ¨ç½²
ç³»ç»Ÿæ”¯æŒ Windows/Linux å¹³å°ï¼Œæ¨èä½¿ç”¨ NVIDIA GPU åŠ é€Ÿã€‚
```bash
# 1. å…‹éš†é¡¹ç›®
git clone [repository_url]
cd Ship-Recog

# 2. å®‰è£… Python ä¾èµ–
pip install -r requirements.txt

# 3. (å¯é€‰) å®‰è£… Ollama ç”¨äº LLaVA åˆ†æ
# è®¿é—® https://ollama.ai ä¸‹è½½å¹¶è¿è¡Œ 'ollama run llava'
```

### 6.2 æ¨¡å‹è®­ç»ƒ
å¦‚éœ€ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®å¢å¼ºæ¨¡å‹æ€§èƒ½ï¼š
```bash
python train.py --epochs 100 --batch 16 --config config.yaml
```

### 6.3 å¯åŠ¨ç³»ç»Ÿ
å¯åŠ¨ Web å¯è§†åŒ–ç•Œé¢ï¼š
```bash
python run_web_advanced.py
```
å¯åŠ¨åè®¿é—® `http://localhost:7860` å³å¯ä½¿ç”¨ã€‚



